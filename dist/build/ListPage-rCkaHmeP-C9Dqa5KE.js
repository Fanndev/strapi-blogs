import{f as L,bv as _,ae as I,u as N,r as M,ah as $,ai as W,a6 as q,g as V,j as e,P as f,L as T,n as H,am as w,an as U,ao as z,bW as Q,ap as X,aq as O,ar as p,T as i,as as Y,ay as G,bX as J,aA as K,aC as Z,au as ee,av as se,a3 as ae,az as x,F as te,B as ne,aB as oe,bY as le}from"./strapi-B-LHh8jx.js";import{u as ie}from"./useAdminRoles-uRNvxyDX-By_GqHDm.js";import{s as re}from"./selectors--muHmKGe-BvffEgJ1.js";const de=({id:s,name:o,description:t,usersCount:d,icons:c,rowIndex:m,canUpdate:u})=>{const{formatMessage:g}=L(),[,r]=c,j=g({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {#  user} one {#  user} other {# users}}"},{number:d});return e.jsxs(O,{"aria-rowindex":m,onClick:u?r.onClick:void 0,children:[e.jsx(x,{maxWidth:"13rem",children:e.jsx(i,{ellipsis:!0,textColor:"neutral800",children:o})}),e.jsx(x,{maxWidth:"25rem",children:e.jsx(i,{ellipsis:!0,textColor:"neutral800",children:t})}),e.jsx(x,{children:e.jsx(i,{textColor:"neutral800",children:j})}),e.jsx(x,{children:e.jsx(te,{justifyContent:"flex-end",onClick:n=>n.stopPropagation(),children:c.map((n,h)=>n?e.jsx(ne,{paddingLeft:h===0?0:1,children:e.jsx(oe,{...n,variant:"ghost"})},n.label):null)})})]},s)},ce=()=>{const{formatMessage:s}=L(),o=_(re),{formatAPIError:t}=I(),{toggleNotification:d}=N(),[c,m]=M.useState(!1),[{query:u}]=$(),{isLoading:g,allowedActions:{canCreate:r,canDelete:j,canRead:n,canUpdate:h}}=W(o.settings?.roles),{roles:R,refetch:A}=ie({filters:u?._q?{name:{$containsi:u._q}}:void 0},{refetchOnMountOrArgChange:!0,skip:g||!n}),C=q(),[{roleToDelete:y},E]=M.useReducer(ge,ue),{post:k}=V(),P=async()=>{try{E({type:"ON_REMOVE_ROLES"}),await k("/admin/roles/batch-delete",{ids:[y]}),await A(),E({type:"RESET_DATA_TO_DELETE"})}catch(a){le(a)&&d({type:"danger",message:t(a)})}},b=()=>C("new"),D=()=>m(a=>!a),S=a=>l=>{l.preventDefault(),l.stopPropagation(),a.usersCount?d({type:"info",message:s({id:"Roles.ListPage.notification.delete-not-allowed"})}):(E({type:"SET_ROLE_TO_DELETE",id:a.id}),D())},v=a=>l=>{l.preventDefault(),l.stopPropagation(),C(`duplicate/${a.id}`)},F=R.length+1,B=6;return g?e.jsx(f.Loading,{}):e.jsxs(f.Main,{children:[e.jsx(f.Title,{children:s({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:"Roles"})}),e.jsx(T.Header,{primaryAction:r?e.jsx(H,{onClick:b,startIcon:e.jsx(w,{}),size:"S",children:s({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})}):null,title:s({id:"global.roles",defaultMessage:"roles"}),subtitle:s({id:"Settings.roles.list.description",defaultMessage:"List of roles"})}),n&&e.jsx(T.Action,{startActions:e.jsx(U,{label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:s({id:"global.roles",defaultMessage:"roles"})})})}),n&&e.jsx(T.Content,{children:e.jsxs(z,{colCount:B,rowCount:F,footer:r?e.jsx(Q,{onClick:b,icon:e.jsx(w,{}),children:s({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})}):null,children:[e.jsx(X,{children:e.jsxs(O,{"aria-rowindex":1,children:[e.jsx(p,{children:e.jsx(i,{variant:"sigma",textColor:"neutral600",children:s({id:"global.name",defaultMessage:"Name"})})}),e.jsx(p,{children:e.jsx(i,{variant:"sigma",textColor:"neutral600",children:s({id:"global.description",defaultMessage:"Description"})})}),e.jsx(p,{children:e.jsx(i,{variant:"sigma",textColor:"neutral600",children:s({id:"global.users",defaultMessage:"Users"})})}),e.jsx(p,{children:e.jsx(Y,{children:s({id:"global.actions",defaultMessage:"Actions"})})})]})}),e.jsx(G,{children:R?.map((a,l)=>e.jsx(de,{id:a.id,name:a.name,description:a.description,usersCount:a.usersCount,icons:[r&&{onClick:v(a),label:s({id:"app.utils.duplicate",defaultMessage:"Duplicate"}),children:e.jsx(J,{})},h&&{onClick:()=>C(a.id.toString()),label:s({id:"app.utils.edit",defaultMessage:"Edit"}),children:e.jsx(K,{})},j&&{onClick:S(a),label:s({id:"global.delete",defaultMessage:"Delete"}),children:e.jsx(Z,{})}].filter(Boolean),rowIndex:l+2,canUpdate:h},a.id))})]})}),e.jsx(ee.Root,{open:c,onOpenChange:D,children:e.jsx(se,{onConfirm:P})})]})},ue={roleToDelete:null,showModalConfirmButtonLoading:!1,shouldRefetchData:!1},ge=(s,o)=>ae(s,t=>{switch(o.type){case"ON_REMOVE_ROLES":{t.showModalConfirmButtonLoading=!0;break}case"ON_REMOVE_ROLES_SUCCEEDED":{t.shouldRefetchData=!0,t.roleToDelete=null;break}case"RESET_DATA_TO_DELETE":{t.shouldRefetchData=!1,t.roleToDelete=null,t.showModalConfirmButtonLoading=!1;break}case"SET_ROLE_TO_DELETE":{t.roleToDelete=o.id;break}default:return t}}),fe=()=>{const s=_(o=>o.admin_app.permissions.settings?.roles.read);return e.jsx(f.Protect,{permissions:s,children:e.jsx(ce,{})})};export{ce as ListPage,fe as ProtectedListPage};
