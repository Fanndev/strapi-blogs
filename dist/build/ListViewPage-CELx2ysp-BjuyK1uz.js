import{d as Q,a7 as W,a6 as ue,f as k,u as pe,ae as me,h9 as G,h6 as ee,r as C,aP as ge,ah as D,h8 as he,hW as fe,ct as U,hc as xe,dw as je,hw as v,j as e,P as w,af as ye,L as z,hX as be,an as Ce,F as P,bx as b,he as Se,T as S,ha as Y,hY as Le,by as N,hZ as Te,h_ as Re,n as Ae,bQ as Ie,am as Me,b_ as Ee,ai as te,h4 as ke,d4 as Fe,h$ as we,bA as se,h7 as Pe,ak as ne,i0 as ae,i1 as ve,bw as H,bC as Oe,bD as Be,bE as De,bP as Z,a2 as V,a_ as q,aB as $e,ax as He,q as Ue,fd as _e,al as We,i2 as Ne,cH as Ve,aw as qe,i3 as ze,i4 as Qe,h3 as Ge,bB as Ye,i5 as Ze,dU as A,dT as Je,e2 as ie,ag as Ke,bz as Xe}from"./strapi-B-LHh8jx.js";import{a as re,u as et,p as J}from"./useDebounce-DmuSJIF3-DvUH3pGg.js";import{g as oe,u as tt}from"./relations-C0w0GcXi-BVXtpHqJ.js";import{u as st}from"./hooks-E5u1mcgM-KAsFkL04.js";const K=["json","component","media","richtext","dynamiczone","password","blocks"],nt=["createdAt","updatedAt"],at=[...ae,"strapi_assignee"],it=({disabled:t,schema:n})=>{const{attributes:s,uid:a,options:o}=n,{formatMessage:l,locale:j}=k(),{trackUsage:g}=W(),r=Fe("FiltersImpl",m=>m.permissions),[{query:h}]=D(),{schemas:p}=we(),L=C.useMemo(()=>r.filter(m=>m.action==="admin::users.read"&&m.subject===null).length>0,[r]),T=(h?.filters?.$and??[]).reduce((m,M)=>{const[y,f]=Object.entries(M)[0];if(typeof f.id!="object")return m;const i=f.id.$eq||f.id.$ne;return i&&at.includes(y)&&!m.includes(i)&&m.push(i),m},[]),{data:x,isLoading:d}=se({filters:{id:{$in:T}}},{skip:T.length===0||!L}),{users:u=[]}=x??{},{metadata:I}=Pe(a,{selectFromResult:({data:m})=>({metadata:m?.contentType.metadatas??{}})}),B=ne(j,{sensitivity:"base"}),O=C.useMemo(()=>{const[{properties:{fields:m=[]}={fields:[]}}]=r.filter(y=>y.action==="plugin::content-manager.explorer.read"&&y.subject===a);return["id",...m.filter(y=>{const f=s[y]??{};return f.type&&!K.includes(f.type)}),...nt,...L?ae:[]].map(y=>{const f=s[y];if(K.includes(f.type))return null;const{mainField:i="",label:E}=I[y].list;let c={name:y,label:E??"",mainField:ve(f,i,{schemas:p,components:{}}),type:f.type};return f.type==="relation"&&"target"in f&&f.target==="admin::user"&&(c={...c,input:rt,options:u.map(F=>({label:Y(F),value:F.id.toString()})),operators:[{label:l({id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"}),value:"$eq"},{label:l({id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"}),value:"$ne"}],mainField:{name:"id",type:"integer"}}),f.type==="enumeration"&&(c={...c,options:f.enum.map(F=>({label:F,value:F}))}),c}).filter(Boolean).toSorted((y,f)=>B.compare(y.label,f.label))},[r,L,a,s,I,p,u,l,B]),R=m=>{m&&g("willFilterEntries")},$=m=>{const M=s[m.name];M&&g("didFilterEntries",{useRelation:M.type==="relation"})};return e.jsxs(H.Root,{disabled:t,options:O,onOpenChange:R,onChange:$,children:[e.jsx(H.Trigger,{}),e.jsx(H.Popover,{}),e.jsx(H.List,{})]})},rt=({name:t})=>{const[n,s]=C.useState(10),[a,o]=C.useState(""),{formatMessage:l}=k(),j=et(a,300),{data:g,isLoading:r}=se({pageSize:n,_q:j}),h=Oe(t),p=u=>{u||s(10)},{users:L=[],pagination:T}=g??{},{pageCount:x=1,page:d=1}=T??{};return e.jsx(Be,{value:h.value,"aria-label":l({id:"content-manager.components.Filters.usersSelect.label",defaultMessage:"Search and select a user to filter"}),onOpenChange:p,onChange:u=>h.onChange(t,u),loading:r,onLoadMore:()=>s(n+10),hasMoreItems:d<x,onInputChange:u=>{o(u.currentTarget.value)},children:L.map(u=>e.jsx(De,{value:u.id.toString(),children:Y(u)},u.id))})},_=({type:t,value:n})=>{const{formatDate:s,formatTime:a,formatNumber:o}=k();let l=n;if(t==="date"&&(l=s(Ye(n),{dateStyle:"full"})),t==="datetime"&&(l=s(n,{dateStyle:"full",timeStyle:"short"})),t==="time"){const[j,g,r]=n.split(":"),h=new Date;h.setHours(j),h.setMinutes(g),h.setSeconds(r),l=a(h,{timeStyle:"short"})}return["float","decimal"].includes(t)&&(l=o(n,{maximumFractionDigits:20})),["integer","biginteger"].includes(t)&&(l=o(n,{maximumFractionDigits:0})),Ze(l)},ot=({content:t,mainField:n})=>n?e.jsx(Z,{label:t[n.name],children:e.jsx(S,{maxWidth:"25rem",textColor:"neutral800",ellipsis:!0,children:e.jsx(_,{type:n.type,value:t[n.name]})})}):null,lt=({content:t,mainField:n})=>{const{formatMessage:s}=k();return n?e.jsxs(A.Root,{children:[e.jsxs(A.Trigger,{onClick:a=>a.stopPropagation(),children:[e.jsx(Je,{children:t.length}),s({id:"content-manager.containers.list.items",defaultMessage:"{number, plural, =0 {items} one {item} other {items}}"},{number:t.length})]}),e.jsx(A.Content,{children:t.map(a=>e.jsx(A.Item,{disabled:!0,children:e.jsx(S,{maxWidth:"50rem",ellipsis:!0,children:e.jsx(_,{type:n.type,value:a[n.name]})})},a.id))})]}):null},ct=t=>t&&t[0]==="."?t.substring(1):t,le=({url:t,mime:n,alternativeText:s,name:a,ext:o,formats:l})=>{const j=J(t);if(n.includes("image")){const h=l?.thumbnail?.url,p=J(h)||j;return e.jsx(ie.Item,{src:p,alt:s||a,fallback:s||a,preview:!0})}const g=ct(o),r=a.length>100?`${a.substring(0,100)}...`:a;return e.jsx(Z,{description:r,children:e.jsx(ce,{children:g})})},ce=({children:t})=>e.jsx(P,{tag:"span",position:"relative",borderRadius:"50%",width:"26px",height:"26px",borderColor:"neutral200",background:"neutral150",paddingLeft:"1px",justifyContent:"center",alignItems:"center",children:e.jsx(dt,{variant:"sigma",textColor:"neutral600",children:t})}),dt=Q(S)`
  font-size: 0.9rem;
  line-height: 0.9rem;
`,ut=({content:t})=>e.jsx(ie.Group,{children:t.map((n,s)=>{const a=`${n.id}${s}`;if(s===3){const o=`+${t.length-3}`;return e.jsx(ce,{children:o},a)}return s>3?null:e.jsx(le,{...n},a)})}),pt=({mainField:t,content:n})=>e.jsx(S,{maxWidth:"50rem",textColor:"neutral800",ellipsis:!0,children:oe(n,t)}),mt=({mainField:t,content:n,rowId:s,name:a})=>{const{model:o}=G(),{formatMessage:l}=k(),{notifyStatus:j}=Ke(),[g,r]=C.useState(!1),[h]=a.split("."),{data:p,isLoading:L}=tt({model:o,id:s,targetField:h},{skip:!g,refetchOnMountOrArgChange:!0}),T=Array.isArray(n)?n.length:n.count;return C.useEffect(()=>{p&&j(l({id:v("DynamicTable.relation-loaded"),defaultMessage:"Relations have been loaded"}))},[p,l,j]),e.jsxs(A.Root,{onOpenChange:x=>r(x),children:[e.jsx(A.Trigger,{onClick:x=>x.stopPropagation(),children:e.jsx(S,{style:{cursor:"pointer"},textColor:"neutral800",fontWeight:"regular",children:T>0?l({id:"content-manager.containers.list.items",defaultMessage:"{number} {number, plural, =0 {items} one {item} other {items}}"},{number:T}):"-"})}),e.jsxs(A.Content,{children:[L&&e.jsx(A.Item,{disabled:!0,children:e.jsx(Xe,{small:!0,children:l({id:v("ListViewTable.relation-loading"),defaultMessage:"Relations are loading"})})}),p?.results&&e.jsxs(e.Fragment,{children:[p.results.map(x=>e.jsx(A.Item,{disabled:!0,children:e.jsx(S,{maxWidth:"50rem",ellipsis:!0,children:oe(x,t)})},x.documentId)),p?.pagination&&p?.pagination.total>10&&e.jsx(A.Item,{"aria-disabled":!0,"aria-label":l({id:v("ListViewTable.relation-more"),defaultMessage:"This relation contains more entities than displayed"}),children:e.jsx(S,{children:"â€¦"})})]})]})]})},gt=({content:t,mainField:n,attribute:s,rowId:a,name:o})=>{if(!ht(t,n,s))return e.jsx(S,{textColor:"neutral800",paddingLeft:s.type==="relation"?"1.6rem":0,paddingRight:s.type==="relation"?"1.6rem":0,children:"-"});switch(s.type){case"media":return s.multiple?e.jsx(ut,{content:t}):e.jsx(le,{...t});case"relation":return de(s.relation)?e.jsx(pt,{mainField:n,content:t}):e.jsx(mt,{rowId:a,mainField:n,content:t,name:o});case"component":return s.repeatable?e.jsx(lt,{mainField:n,content:t}):e.jsx(ot,{mainField:n,content:t});case"string":return e.jsx(Z,{description:t,children:e.jsx(S,{maxWidth:"30rem",ellipsis:!0,textColor:"neutral800",children:e.jsx(_,{type:s.type,value:t})})});default:return e.jsx(S,{maxWidth:"30rem",ellipsis:!0,textColor:"neutral800",children:e.jsx(_,{type:s.type,value:t})})}},ht=(t,n,s)=>{if(s.type==="component"){if(s.repeatable||!n)return t?.length>0;const a=t?.[n.name];return n.name==="id"&&![void 0,null].includes(a)?!0:!V(a)}return s.type==="relation"?de(s.relation)?!V(t):Array.isArray(t)?t.length>0:t?.count>0:["integer","decimal","float","number"].includes(s.type)?typeof t=="number":s.type==="boolean"?t!==null:!V(t)},de=t=>["oneToOne","manyToOne","oneToOneMorph"].includes(t),ft=t=>{const n=st(l=>l.admin_app.permissions.contentManager?.collectionTypesConfigurations??[]),[{query:s}]=D(),{formatMessage:a}=k(),{allowedActions:{canConfigureView:o}}=te(n);return e.jsxs(q.Root,{children:[e.jsx(q.Trigger,{children:e.jsx($e,{label:a({id:"components.ViewSettings.tooltip",defaultMessage:"View Settings"}),children:e.jsx(He,{})})}),e.jsx(q.Content,{side:"bottom",align:"end",sideOffset:4,children:e.jsxs(P,{alignItems:"stretch",direction:"column",padding:3,gap:3,children:[o?e.jsx(Ue,{size:"S",startIcon:e.jsx(_e,{}),variant:"secondary",tag:We,to:{pathname:"configurations/list",search:s.plugins?U.stringify({plugins:s.plugins},{encode:!1}):""},children:a({id:"app.links.configure-view",defaultMessage:"Configure the view"})}):null,e.jsx(xt,{...t})]})})]})},xt=({headers:t=[],resetHeaders:n,setHeaders:s})=>{const{trackUsage:a}=W(),{formatMessage:o,locale:l}=k(),{schema:j,model:g}=G(),{list:r}=ee(g),h=ne(l,{sensitivity:"base"}),p=j?.attributes??{},L=Object.keys(p).filter(d=>Ne(p[d])).map(d=>({name:d,label:r.metadatas[d]?.label??""})).sort((d,u)=>h.compare(d.label,u.label)),T=d=>{a("didChangeDisplayedFields");const u=t.includes(d)?t.filter(I=>I!==d):[...t,d];s(u)},x=()=>{n()};return e.jsxs(P,{tag:"fieldset",direction:"column",alignItems:"stretch",gap:3,borderWidth:0,children:[e.jsxs(P,{justifyContent:"space-between",children:[e.jsx(S,{tag:"legend",variant:"pi",fontWeight:"bold",children:o({id:"containers.list.displayedFields",defaultMessage:"Displayed fields"})}),e.jsx(Ve,{onClick:x,children:o({id:"app.components.Button.reset",defaultMessage:"Reset"})})]}),e.jsx(P,{direction:"column",alignItems:"stretch",children:L.map(d=>{const u=t.includes(d.name);return e.jsx(P,{wrap:"wrap",gap:2,background:u?"primary100":"transparent",hasRadius:!0,padding:2,children:e.jsx(qe,{onCheckedChange:()=>T(d.name),checked:u,name:d.name,children:e.jsx(S,{fontSize:1,children:d.label})})},d.name)})})]})},{INJECT_COLUMN_IN_TABLE:jt}=ze,yt=Q(z.Header)`
  overflow-wrap: anywhere;
`,bt=()=>{const{trackUsage:t}=W(),n=ue(),{formatMessage:s}=k(),{toggleNotification:a}=pe(),{_unstableFormatAPIError:o}=me(v),{collectionType:l,model:j,schema:g}=G(),{list:r}=ee(j),[h,p]=C.useState([]),L=re(r.layout);C.useEffect(()=>{ge(L,r.layout)||p(r.layout)},[r.layout,L]);const T=i=>{p(Qe(i,g.attributes,r.metadatas))},[{query:x}]=D({page:"1",pageSize:r.settings.pageSize.toString(),sort:r.settings.defaultSortBy?`${r.settings.defaultSortBy}:${r.settings.defaultSortOrder}`:""}),d=C.useMemo(()=>he(x),[x]),{data:u,error:I,isFetching:B}=fe({model:j,params:d});C.useEffect(()=>{I&&a({type:"danger",message:o(I)})},[I,o,a]);const{results:O=[],pagination:R}=u??{};C.useEffect(()=>{R&&R.pageCount>0&&R.page>R.pageCount&&n({search:U.stringify({...x,page:R.pageCount})},{replace:!0})},[R,s,x,n]);const{canCreate:$}=xe("ListViewPage",({canCreate:i})=>({canCreate:i})),m=je("ListViewPage",({runHookWaterfall:i})=>i),M=C.useMemo(()=>{const E=m(jt,{displayedHeaders:h,layout:r}).displayedHeaders.map(c=>({...c,label:typeof c.label=="string"?c.label:s(c.label),name:`${c.name}${c.mainField?.name?`.${c.mainField.name}`:""}`}));return g?.options?.draftAndPublish&&E.push({attribute:{type:"custom"},name:"status",label:s({id:v("containers.list.table-headers.status"),defaultMessage:"status"}),searchable:!1,sortable:!1}),E},[h,s,r,m,g?.options?.draftAndPublish]);if(B)return e.jsx(w.Loading,{});if(I)return e.jsx(w.Error,{});const y=g?.info.displayName??"Untitled",f=i=>()=>{t("willEditEntryFromList"),n({pathname:i.toString(),search:U.stringify({plugins:x.plugins})})};return e.jsxs(w.Main,{children:[e.jsx(w.Title,{children:`${y}`}),e.jsx(yt,{primaryAction:$?e.jsx(X,{}):null,subtitle:s({id:v("pages.ListView.header-subtitle"),defaultMessage:"{number, plural, =0 {# entries} one {# entry} other {# entries}} found"},{number:R?.total}),title:y,navigationAction:e.jsx(ye,{})}),e.jsx(z.Action,{endActions:e.jsxs(e.Fragment,{children:[e.jsx(be,{area:"listView.actions"}),e.jsx(ft,{setHeaders:T,resetHeaders:()=>p(r.layout),headers:h.map(i=>i.name)})]}),startActions:e.jsxs(e.Fragment,{children:[r.settings.searchable&&e.jsx(Ce,{disabled:O.length===0,label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:y}),placeholder:s({id:"global.search",defaultMessage:"Search"}),trackedEvent:"didSearch"}),r.settings.filterable&&g?e.jsx(it,{disabled:O.length===0,schema:g}):null]})}),e.jsx(z.Content,{children:e.jsxs(P,{gap:4,direction:"column",alignItems:"stretch",children:[e.jsxs(b.Root,{rows:O,headers:M,isLoading:B,children:[e.jsx(St,{}),e.jsxs(b.Content,{children:[e.jsxs(b.Head,{children:[e.jsx(b.HeaderCheckboxCell,{}),M.map(i=>e.jsx(b.HeaderCell,{...i},i.name))]}),e.jsx(b.Loading,{}),e.jsx(b.Empty,{action:$?e.jsx(X,{variant:"secondary"}):null}),e.jsx(b.Body,{children:O.map(i=>e.jsxs(b.Row,{cursor:"pointer",onClick:f(i.documentId),children:[e.jsx(b.CheckboxCell,{id:i.id}),M.map(({cellFormatter:E,...c})=>{if(c.name==="status"){const{status:F}=i;return e.jsx(b.Cell,{children:e.jsx(Se,{status:F,maxWidth:"min-content"})},c.name)}return["createdBy","updatedBy"].includes(c.name.split(".")[0])?e.jsx(b.Cell,{children:e.jsx(S,{textColor:"neutral800",children:i[c.name.split(".")[0]]?Y(i[c.name.split(".")[0]]):"-"})},c.name):typeof E=="function"?e.jsx(b.Cell,{children:E(i,c,{collectionType:l,model:j})},c.name):e.jsx(b.Cell,{children:e.jsx(gt,{content:i[c.name.split(".")[0]],rowId:i.documentId,...c})},c.name)}),e.jsx(Ct,{onClick:E=>E.stopPropagation(),children:e.jsx(Le,{document:i})})]},i.id))})]})]}),e.jsxs(N.Root,{...R,onPageSizeChange:()=>t("willChangeNumberOfEntriesPerPage"),children:[e.jsx(N.PageSize,{}),e.jsx(N.Links,{})]})]})})]})},Ct=Q(b.Cell)`
  display: flex;
  justify-content: flex-end;
`,St=()=>{const t=Te("TableActionsBar",o=>o.selectRow),[{query:n}]=D(),s=n?.plugins?.i18n?.locale,a=re(s);return C.useEffect(()=>{a!==s&&t([])},[t,a,s]),e.jsx(b.ActionBar,{children:e.jsx(Re,{})})},X=({variant:t})=>{const{formatMessage:n}=k(),{trackUsage:s}=W(),[{query:a}]=D();return e.jsx(Ae,{variant:t,tag:Ie,onClick:()=>{s("willCreateEntry",{status:"draft"})},startIcon:e.jsx(Me,{}),style:{textDecoration:"none"},to:{pathname:"create",search:U.stringify({plugins:a.plugins})},minWidth:"max-content",marginLeft:2,children:n({id:v("HeaderLayout.button.label-add-entry"),defaultMessage:"Create new entry"})})},It=()=>{const{slug:t=""}=Ee(),{permissions:n=[],isLoading:s,error:a}=te(Ge.map(o=>({action:o,subject:t})));return s?e.jsx(w.Loading,{}):a||!t?e.jsx(w.Error,{}):e.jsx(w.Protect,{permissions:n,children:({permissions:o})=>e.jsx(ke,{permissions:o,children:e.jsx(bt,{})})})};export{bt as ListViewPage,It as ProtectedListViewPage};
